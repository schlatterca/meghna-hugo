{{ define "main" }}

{{ partial "navigation.html" . }}

{{/* - partial "footer.html" . -*/}}

<section class="section">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 offset-lg-2 text-center">
        <p id="this_article_type"><a href="..\"{{ .Type }}>{{ .Type }}</a></p>
        <h1 id="this_article_title">{{ .Title }}</h1>
        <p id="this_article_author">by {{ .Params.author }}</p>
        
      </div>

      <div class="synopsis_box">
        <p class="synopsis">{{ .Description }}</p>
        <div class="open_synopsis_box">+</div>
      </div>

      <div class="col-lg-8 offset-lg-2">
        <div class="post-single-content articleContent">
          {{ .Content }}
        </div>
        <!--div class="mt-5"-->
          {{/* .Date */}} <!--JUST TO TRY THE COMMENT-->
        <!--/div-->
      </div>
    </div>
  </div>
</section>

<footer>
  <div id="footer" class="foot1" onmouseover="toggleFooter(this)" onmouseout="toggleFooter(this)">
    <p class="footer_title footitle1">Barberini Harp Project</p>
    <div class="footer_insidebox">
      <p class="footer_insidetext">{{ .Params.barberiniharpproject }}</p>
    </div>
  </div>
  <div id="footer" class="foot2" onmouseover="toggleFooter(this)" onmouseout="toggleFooter(this)">
    <p class="footer_title footitle2">Related Research</p>
    <div class="footer_insidebox">
      <!--p class="footer_insidetext">Related Research here</p-->
    </div>
  </div>
  <div id="footer" class="foot3" onmouseover="toggleFooter(this)" onmouseout="toggleFooter(this)">
    <p class="footer_title footitle3">External Links</p>
    <div class="footer_insidebox">
      <p class="footer_insidetext">{{ .Params.externallinks }}</p>
    </div>
  </div>
  <div id="footer" class="foot4" onmouseover="toggleFooter(this)" onmouseout="toggleFooter(this)">
    <p class="footer_title footitle4">Tags</p>
    <div class="footer_insidebox">
      <p class="footer_insidetext">{{ .Params.tags }}</p>
    </div>
  </div>
  <div id="footer" class="foot5" onmouseover="toggleFooter(this)" onmouseout="toggleFooter(this)">
    <p class="footer_title footitle5">Downloads</p>
    <div class="footer_insidebox">
      <p class="footer_insidetext">{{ .Params.downloads }}</p>
    </div>
  </div>
</footer>

<script>
  /*add links to each person that appears in the person_tag section*/
  var persontags_list = {{ .Params.person_tag }};
  var paragraphs = document.getElementsByClassName("articleContent")[0].childNodes;

  for(var j = 0; j < paragraphs.length; j++) {
    for (let i = 0; i < persontags_list.length; i++) {
      if ((typeof paragraphs[j].innerHTML !== 'undefined') && (paragraphs[j].innerHTML.includes(persontags_list[i]))){

        var link = document.createElement('a');
        var linkText = document.createTextNode(persontags_list[i]);

        if (persontags_list[i].includes(' ')){
          var nameToSwap = persontags_list[i].split(' ');
          var first = nameToSwap[0];
          var last = nameToSwap[nameToSwap.length - 1];
          nameToSwap[0] = last;
          nameToSwap[nameToSwap.length - 1] = first;
          var nameSwapped = nameToSwap.join(' ');
        } else {
          var nameSwapped = persontags_list[i];
        }

        link.setAttribute('href', 'https://harfenlabor.netlify.app/persontags#'+nameSwapped);
        link.appendChild(linkText);




        /*var targetWord = persontags_list[i];
        var textNode = paragraphs[j].firstChild.innerHTML;

        console.log(paragraphs[j].firstChild, paragraphs[j].firstChild.innerText, paragraphs[j].firstChild.innerHTML);

        // Find our text in the text node
        var index = textNode.nodeValue.indexOf(targetWord);
        if (index !== -1) {
          // Split at the beginning of the text
          var nodeWord = textNode.splitText(index);

          // Split the new node again at the end of the word
          var nodeAfter = nodeWord.splitText(targetWord.length);

          // Insert a new anchor in front of the word
          //var anchor = document.createElement('a');
          //var anchor.href = "http://stackoverflow.com";
          //p.insertBefore(anchor, nodeWord);
          p.insertBefore(link, nodeWord);

          // Now move the word *into* the anchor
          anchor.appendChild(nodeWord);
        }*/




        /*var paragText = paragraphs[j].innerText.split(persontags_list[i]);

        console.log(paragText[0]);
        console.log(paragText[1]);

        var span_0 = document.createElement('span');
        var spanText_0 = document.createTextNode(paragText[0]);
        span_0.appendChild(spanText_0);
        var span_1 = document.createElement('span');
        var spanText_1 = document.createTextNode(paragText[1]);
        span_1.appendChild(spanText_1);

        paragraphs[j].innerText = "";
        paragraphs[j].append(span_0);
        paragraphs[j].append(link);
        paragraphs[j].append(span_1);*/



        /*var replacedText = paragraphs[j].innerText.replace(persontags_list[i], link);
        console.log(replacedText);
        paragraphs[j].appendChild(link);*/



        /*var paragraphSplit = paragraphs[j].innerHTML.split(persontags_list[i]);
        console.log(paragraphSplit[0]);
        console.log(paragraphSplit[1]);
        paragraphs[j].appendChild(link);*/


        //paragraphSplit[0].append(link);
        //paragraphs[j] = paragraphSplit.innerHTML.join(persontags_list[i]);
        //paragraphs[j].innerHTML.replace('a', 'lero');
        //console.log(paragraphs[j].innerHTML, persontags_list[i]);
      }
    }
  }

</script>

{{ end }}
