{{ define "main" }}

{{ partial "navigation.html" . }}

{{/* - partial "footer.html" . -*/}}

<section class="section">

  <div class="container">
    <div class="row">
      <div class="col-lg-8 offset-lg-2 text-center">
        <p id="this_article_type"><a href="..\"{{ .Type }}>{{ .Type }}</a></p>
        <h1 id="this_article_title">{{ .Title }}</h1>
        <p id="this_article_author">by {{ .Params.author }}</p>
        
      </div>

      {{ if .Description }}
      <div class="synopsis_box">
        <p class="synopsis">Synopsis: {{ .Description }}</p>
        <div class="open_synopsis_box">+</div>
      </div>
      {{ end }}

      <div class="col-lg-8 offset-lg-2">
        <div class="post-single-content articleContent">
          {{ .Content }}
        </div>
        {{ if .Params.footnotes }}
        <div id="extraspace"></div>
        {{ end }}
      </div>

      {{ if .Params.footnotes }}
      <div class="footnotes_box">
        <p class="footnotes">Footnotes: {{ .Params.footnotes }}</p>
        <div class="open_footnotes_box">+</div>
      </div>
      {{ end }}

    </div>
  </div>
</section>

<footer>
  <div id="footer" class="foot1" onmouseover="toggleFooter(this)" onmouseout="toggleFooter(this)">
    <p class="footer_title footitle1">Barberini Harp Project</p>
    <div class="footer_insidebox">
      <p class="footer_insidetext">{{ .Params.barberiniharpproject }}</p>
    </div>
  </div>
  <div id="footer" class="foot2" onmouseover="toggleFooter(this)" onmouseout="toggleFooter(this)">
    <p class="footer_title footitle2">Related Research</p>
    <div class="footer_insidebox">
      <!--p class="footer_insidetext">Related Research here</p-->
    </div>
  </div>
  <div id="footer" class="foot3" onmouseover="toggleFooter(this)" onmouseout="toggleFooter(this)">
    <p class="footer_title footitle3">External Links</p>
    <div class="footer_insidebox">
      <p class="footer_insidetext">{{ .Params.externallinks }}</p>
    </div>
  </div>
  <div id="footer" class="foot4" onmouseover="toggleFooter(this)" onmouseout="toggleFooter(this)">
    <p class="footer_title footitle4">Tags</p>
    <div class="footer_insidebox">
      <p class="footer_insidetext">{{ .Params.tags }}</p>
    </div>
  </div>
  <div id="footer" class="foot5" onmouseover="toggleFooter(this)" onmouseout="toggleFooter(this)">
    <p class="footer_title footitle5">Downloads</p>
    <div class="footer_insidebox">
      <p class="footer_insidetext">{{ .Params.downloads }}</p>
    </div>
  </div>
</footer>

<script>
  //add links to each person that appears in the person_tag section
  var persontags_list = {{ .Params.person_tag }};
  var paragraphs = document.getElementsByClassName("articleContent")[0].childNodes;

  for (let i = 0; i < persontags_list.length; i++) {
    //for(var j = 0; j < paragraphs.length; j++) {
    for(var j = 0; j < 8; j++) {
      if ((typeof paragraphs[j].innerHTML !== 'undefined') && (paragraphs[j].innerHTML.includes(persontags_list[i]))){

        //create link with the name
        var link = document.createElement('a');
        var linkText = document.createTextNode(persontags_list[i]);
        if (persontags_list[i].includes(' ')){
          var nameToSwap = persontags_list[i].split(' ');
          var first = nameToSwap[0];
          var last = nameToSwap[nameToSwap.length - 1];
          nameToSwap[0] = last;
          nameToSwap[nameToSwap.length - 1] = first;
          var nameSwapped = nameToSwap.join(' ');
        } else {
          var nameSwapped = persontags_list[i];
        }
        link.setAttribute('href', 'https://harfenlabor.netlify.app/persontags#'+nameSwapped);
        link.appendChild(linkText);
      }
    }
  }

  var words = [];
  for (let i = 0; i < persontags_list.length; i++) {

    if (persontags_list[i].includes(' ')){
      var nameToSwap = persontags_list[i].split(' ');
      var first = nameToSwap[0];
      var last = nameToSwap[nameToSwap.length - 1];
      nameToSwap[0] = last;
      nameToSwap[nameToSwap.length - 1] = first;
      var nameSwapped = nameToSwap.join(' ').replace(' ', '%20');
    } else {
      var nameSwapped = persontags_list[i].replace;
    }

    var Obj = {}
    Obj.word = persontags_list[i];
    Obj.link = nameSwapped;
    words.push(Obj);
  }

  $.each(words,
    function() {
      var search = this;
      $('span#person_tag').each(
        function() {
          if ($(this).text() === search.word) {
            $(this).html('<a href="https://harfenlabor.netlify.app/persontags#' + search.link + '">' + search.word + '</a>');
          }
        }
      );
    }
  );

  //make footnotes interactive
  $('sup').each(
    function() {
      console.log($(this));
    }
  );

</script>

{{ end }}
